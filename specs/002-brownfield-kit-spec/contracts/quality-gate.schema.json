{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://brownkit.dev/schemas/quality-gate.json",
  "title": "QualityGate",
  "description": "Quality gate definitions and validation results",
  "type": "object",
  "required": ["schema_version", "gates", "summary"],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "gates": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "id",
          "name",
          "description",
          "metric_path",
          "operator",
          "threshold",
          "severity",
          "passed"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z_]+$",
            "description": "Unique gate identifier (snake_case)"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Human-readable gate name"
          },
          "description": {
            "type": "string",
            "description": "What this gate validates"
          },
          "metric_path": {
            "type": "string",
            "pattern": "^[a-z_]+(\\.[a-z_]+)*$",
            "description": "Dot-notation path to metric (e.g., testing.coverage_percent)"
          },
          "operator": {
            "type": "string",
            "enum": [">=", "<=", "==", "!=", ">", "<"],
            "description": "Comparison operator"
          },
          "threshold": {
            "description": "Required value for gate to pass",
            "oneOf": [
              {"type": "number"},
              {"type": "boolean"},
              {"type": "string"}
            ]
          },
          "severity": {
            "type": "string",
            "enum": ["required", "recommended"],
            "description": "Gate importance level"
          },
          "passed": {
            "type": "boolean",
            "description": "Whether gate currently passes"
          },
          "current_value": {
            "description": "Current metric value",
            "oneOf": [
              {"type": "number"},
              {"type": "boolean"},
              {"type": "string"},
              {"type": "null"}
            ]
          },
          "message": {
            "type": "string",
            "description": "Status explanation"
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "required": [
        "total_gates",
        "passed",
        "failed",
        "all_passed",
        "required_passed"
      ],
      "properties": {
        "total_gates": {
          "type": "integer",
          "minimum": 0
        },
        "passed": {
          "type": "integer",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "minimum": 0
        },
        "all_passed": {
          "type": "boolean",
          "description": "Whether all gates passed"
        },
        "required_passed": {
          "type": "boolean",
          "description": "Whether all required gates passed"
        }
      }
    }
  }
}
